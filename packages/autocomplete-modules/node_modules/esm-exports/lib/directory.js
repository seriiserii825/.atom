"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Path = require("path");
var parse_file_1 = require("./parse-file");
var flatten = require("lodash/flatten");
var startsWith = require("lodash/startsWith");
var utils_1 = require("./utils");
function directory(target) {
    if (typeof target !== 'string') {
        return Promise.reject(new Error('Target must be a string'));
    }
    var targetNodeModules = Path.normalize(Path.join(target, 'node_modules')).replace(/\\/g, '/');
    var mapIterator = function (file) {
        if (startsWith(file, targetNodeModules))
            return;
        if (!(utils_1.fileExtensions2.indexOf(file.slice(-3)) !== -1 || utils_1.fileExtensions3.indexOf(file.slice(-4)) !== -1))
            return;
        return file;
    };
    return utils_1.fileList(target, mapIterator)
        .catch(function (err) { return []; })
        .then(function (files) {
        return Promise.all(files.map(function (file) {
            file = Path.resolve(file);
            return parse_file_1.parseFile(file, { dirname: target });
        }))
            .then(function (result) {
            return flatten(result);
        });
    });
}
exports.directory = directory;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlyZWN0b3J5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2RpcmVjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDJCQUE2QjtBQUM3QiwyQ0FBeUM7QUFDekMsd0NBQTJDO0FBQzNDLDhDQUFpRDtBQUVqRCxpQ0FBcUU7QUFFckUsbUJBQTBCLE1BQWM7SUFDcEMsRUFBRSxDQUFDLENBQUMsT0FBTyxNQUFNLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQztRQUM3QixNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLENBQUM7SUFDaEUsQ0FBQztJQUNELElBQU0saUJBQWlCLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDaEcsSUFBTSxXQUFXLEdBQUcsVUFBQyxJQUFZO1FBQzdCLEVBQUUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztZQUFDLE1BQU0sQ0FBQztRQUNoRCxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsdUJBQWUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksdUJBQWUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUFDLE1BQU0sQ0FBQztRQUNoSCxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2hCLENBQUMsQ0FBQztJQUNGLE1BQU0sQ0FBQyxnQkFBUSxDQUFDLE1BQU0sRUFBRSxXQUFXLENBQUM7U0FDL0IsS0FBSyxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsRUFBRSxFQUFGLENBQUUsQ0FBQztTQUNoQixJQUFJLENBQVUsVUFBQyxLQUFlO1FBQzNCLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUNkLEtBQUssQ0FBQyxHQUFHLENBQUMsVUFBQSxJQUFJO1lBQ1YsSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDMUIsTUFBTSxDQUFDLHNCQUFTLENBQUMsSUFBSSxFQUFFLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFDaEQsQ0FBQyxDQUFDLENBQUM7YUFDRixJQUFJLENBQUMsVUFBQSxNQUFNO1lBQ1IsTUFBTSxDQUFDLE9BQU8sQ0FBTSxNQUFNLENBQUMsQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNYLENBQUMsQ0FBQyxDQUFDO0FBQ1gsQ0FBQztBQXRCRCw4QkFzQkMifQ==